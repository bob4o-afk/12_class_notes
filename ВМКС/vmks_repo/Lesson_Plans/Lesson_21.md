# --- Тема 21 ---

Дата на провеждане 18.3.2022

Теми: Управление и използване на Течно-Кристален Екран (LCD)

## План на часа
- Кратък преговор на вътрешната структура и начин на работа на драйвера [HD44780](https://gitlab.com/tues-embedded/vmks/-/blob/master/Datasheets/HD44780.pdf)
- Обяснение за цифрови интерфейси -> какво са setup time и hold time
- Как се подават данни през интерфейса от микроконтролера
	1. Алгоритъм на предаване
	2. Електрически параметри на сигналите
		* амплитудни дадени са в [документацията на драйвера HD44780](https://gitlab.com/tues-embedded/vmks/-/blob/master/Datasheets/HD44780.pdf)
		* времеви - дадени са в [документацията на LCD 16x2 модула](https://gitlab.com/tues-embedded/vmks/-/tree/master/Datasheets/LCD_16x2_example_datasheet_ADM1602K-NSW-FBS-3.3v.pdf) 
- Създаване на програма за управление на дисплея без библиотека → общо взето [тази](https://gitlab.com/tues-embedded/vmks/-/tree/master/Examples/LCD_without_library_simple) от примерните програми който са в GitLab
- Как се инициализира драйвера и дисплея (има го добре обяснено във видеоклипа от първия линк в "Допълнително")
	1. Избира се 4-битов режим
	2. Задава се режим на въвеждане
	3. Изчиства се екрана и курсорът се връща в началото
	4. Разрешава се работата на екрана
	5. Изпращат се символите за показване ...
- Демонстрация на готовата програма (за съжаление не особенно успешно поради това, че бях тествал само на симулация в TinkerCAD)

Проблемите описани в бележките са коригирани в двата примера в GitLab, като и двата примера(линкове по надолу в секция допълнително) имат коментари кой ред за какво е и изчакванията са зададени като няколко пъти минималната стойност от документацията за да се вижда ясно коя минимална стойност каква е и съответно от къде е взета от таблицата с командите.

Бележки:
- Трябва да има 40ms изчакване в началото на програмата за да се инициализира драйвера след подаване на захранването
- Трябва да не се забравя да се зададе режимът на изводите на микроконтролера да е ИЗХОДЕН (както аз забравих в края на часа с 12А клас :))
- Освен изчакванията между различните сигнали трябва да се сложат и изчаквания след подаването на всяка команда(в документацията пише коя команда колко време се "очаква" да отнеме за изпълнение). Оказа се, че явно реалните модули реагират доста по-бавно от времената указани в документацията и това беше причината програмата да не тръгна в края на часа с 12Б клас, тъй като примерът който бях подготвил да правим ви казах че се изпълнява достатъчно бавно да задоволи изчакванията указани в документацията, но на практика трябва да се изчаква повече за да работи(след часа останах да тествам и го намерих написано в някой от коментарите в кода на стандартната библиотека LiquidCrystal и като сложих допълнително тези изчаквания програмата тръгна - за това е важно да си тествате програмите и на реален хардуер а не само на симулации, тъй като те не винаги симулират пълното поведение на хардуера, а само основните му финкции).

-----

### Допълнително:

[Как работи екрана и пример без използване на библиотека и въобще без микроконтролер](https://www.youtube.com/watch?v=cXpeTxC3_A4) ← това правихме общо взето в часа, но с ардуиното вместо с бутони 

[Проста примерна програма за управление на LCD с HD44780 без библиотека](https://gitlab.com/tues-embedded/vmks/-/tree/master/Examples/LCD_without_library_simple)  
[По-пълна примерна програма за управление на LCD с HD44780 без библиотека](https://gitlab.com/tues-embedded/vmks/-/tree/master/Examples/LCD_without_library)  
[Примерна документация на LCD 16x2 модул](https://gitlab.com/tues-embedded/vmks/-/tree/master/Datasheets/LCD_16x2_example_datasheet_ADM1602K-NSW-FBS-3.3v.pdf)  

Кодът на стандартната библиотека LiquidCrystal на Arduino може да намерите в директория `C:\Users\[username]\Documents\Arduino\libraries\LiquidCrystal\src` под Windows (за друга ОС потърсете в интернет къде са библиотеките).