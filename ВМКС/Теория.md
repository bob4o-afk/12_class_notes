# Embedded System (Вградена система)

Устройство, което съдържа микроконтролер и е специализирано за извършване на специфични задачи. Пример за вградени системи включва: микровълнови фурни, роботи, автомобилни системи и др.

## Микроконтролер vs Микропроцесор

| **Критерий**            | **Микроконтролер (MCU)** | **Микропроцесор (CPU)** | **Обяснение**                                                                                   |
|-------------------------|--------------------------|--------------------------|-------------------------------------------------------------------------------------------------|
| **Изчислителен ресурс**  | Малък                    | Голям                    | MCU имат ограничени изчислителни възможности, докато CPU са проектирани за висока производителност.|
| **Брой транзистори**     | Малко                    | Много                    | MCU имат по-малко транзистори за по-ниска сложност и по-ниска консумация на енергия. CPU имат повече транзистори за по-голяма изчислителна мощност. |
| **Вградена RAM**         | Да                       | Не* (има cache)           | Микроконтролерите имат вградена RAM за основни операции, докато CPU обикновено използват външна RAM, допълнена с кеш. |
| **Вградена ROM**         | Да*                      | Не*                      | MCU имат вграден ROM за съхранение на инструкции, докато CPU разчитат на външна памет за съхранение на програмен код. |
| **Виртуална памет**      | Не*                      | Да                       | CPU поддържат виртуална памет, което им позволява да използват по-големи количества оперативна памет. |
| **Периферни модули**     | Много                    | Малко                    | MCU имат вградени периферни модули като таймери, ADC, и PWM, докато CPU използват външни устройства за тези функции. |

\* Има някои изключения

### Примери:

- **Микроконтролер (MCU):** Arduino, ESP32, STM32
- **Микропроцесор (CPU):** Intel Core i7, AMD Ryzen, ARM Cortex-A

## Как се изчислява колко бита е системата?

За да определим колко бита е дадена система, можем да разгледаме ширината на шината, използвана от процесора. Например:

- **8-битова система:** Микроконтролерът обработва 8 бита наведнъж (например AVR микроконтролери).
- **16-битова система:** Обработва 16 бита наведнъж (например MSP430).
- **32-битова система:** Обработва 32 бита наведнъж (например STM32).

## Тактова честота и изпълнение

- **Такт** - Това е една единична стъпка в работата на процесора, определяна от неговата тактова честота (честотата на осцилатора). Например 1 GHz означава 1 милиард такта в секунда.
- **АЛУ (Аритметико-логическо устройство):** То обработва зададените битове във всеки такт. Пример: 8-битова АЛУ може да обработва 8 бита за един такт.
  
  Например, ако процесорът е 8-битов и има тактова честота от 16 MHz, това означава, че той може да извършва 16 милиона операции за секунда, като всяка операция обработва 8 бита.

## Pipeline (Конвейер)

**Конвейерът** е техника за подобряване на производителността, като позволява едновременното изпълнение на различни стъпки от обработката на инструкциите. При тази техника инструкциите са разделени на няколко етапа (напр. извличане на инструкция, декодиране, изпълнение и запис), които се изпълняват успоредно. Това увеличава скоростта на изпълнение на програмата.

## Архитектури на памет

### Архитектура на фон Нойман

- **Общо описание:** Данните и инструкциите се съхраняват в една и съща памет. Процесорът извлича както данните, така и инструкциите от една и съща шина.
- **Предимства:** Определена простота в дизайна.
- **Недостатъци:** Възниква т.нар. "bottleneck" (тясно място), където процесорът може да бъде забавен, защото може да чете или инструкции, или данни в даден момент, но не и двете едновременно.

### Харвардска архитектура

- **Общо описание:** Паметта за инструкции и паметта за данни са отделни и се използват различни шини за достъп до тях.
- **Предимства:** Процесорът може да чете инструкции и данни едновременно, което подобрява производителността.
- **Недостатъци:** По-сложен дизайн и може да изисква повече памет.

### Пример за харвардска архитектура:
- **Микроконтролерът** STM32 използва харвардска архитектура, при която инструкциите и данните са отделени и се достъпват поотделно.


## Platformio
- https://docs.platformio.org/en/latest/integration/ide/vscode.html#ide-vscode-toolbar


## Presentation
- https://gitlab.com/tues-embedded/vmks-presentations










---
Void pointer - size-а трябва да е достатъчно че да покрие цялата шина
16 битова адресна шина - сайза е 16 бита
трябва да е ПОНЕ


В data segment-a отиват вс глобални и статични локални променливи с ненулева начална стойност. Той заема най-ниските адреси

heap  - динамично заделената памет


stack ппц се намира в "по-горните адреси" и когато се заделя памет за променливи той отива "надолу" а когато има return се връща нагоре. 
има:
1. локални променливи (които не са в data и bss)
2. return стойности когато са прекалено големи за да се съберат в регистри
3. аргументи (не е задължително, пак ако могат да влязат в регистрите са там)
4. return pointer-а на функцията - към какъв адрес се връща след като приключи
ние се намираме на някакъв адрес при четене - викаме функцията запазваме го и след това се връща на този запазен address
5. имаме междинни регистри които запазват някви междинни стойности при изчисляване - те трябва да се запазят някъде преди викане на друга функция защото регистрите ще се помажат - та преди викане се копват в stack-a 

bss - block started by symbol - вс глобални и статични локални променливи с нулева начална -стойност -> сумата от размерите им се запазва

!! application binary interface

Зависимост от архитектурата:
const променливите могат да се пазят или в bss или в data, а може да има и отделен сегмент без право да не се променят


когато заделяме константи като макрота може да не се изпозлва RAM



RAM:
![alt text](images/image.png)


в адресното пространство на RAM-а има и други памети:
- EEPROM
- регистри на периферните устройства


периферни блокове:
GPIO - general purpose input output


тригер на шмит
логическа единица когато пресече горната граница и ДЪРЖИ така докато не пресече долната граница
![alt text](images/image-1.png)



port - група от пинове
когато искаме да дадем на даден пин дали е вход или изход - 13.2.1, 72стр


bitwise opperations
&, |, ~, ^
and, or, not, xor

<<  ,   >>


1 << 5 = 0010000

a = a | (1 <<5)  - вдигаме определен бит във високо ниво
a |= 1 << 5


смъкваме на 0
а &= ~(1 << 5) - определен бит

в нашия случай 5ти







---
!!stack canery (стеково канарче)


ddr pin port


